<!DOCTYPE html>
<html lang="pt-BR">
<head> 
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="author" content="Ivan Montibeller">
  <meta name="description" content="ESF Thamara Katryne Rodrigues Schmidt - Unidade de SaÃºde da FamÃ­lia em Blumenau - SC">
  <meta name="keywords" content="ESF, SaÃºde da FamÃ­lia, Blumenau, SC, Unidade de SaÃºde, Thamara Katryne Rodrigues Schmidt, Atendimento MÃ©dico, SaÃºde ComunitÃ¡ria">
  <title>Dashboard MÃ©dico â€” ESF Thamara</title>
  <link rel="stylesheet" href="./css/xp-responsive.css">
</head>

<body> 
  <!-- Barra de menus -->
  <div>
  <nav style="background:#0b5fa5; color:#fff; padding:10px; display:flex; justify-content:center; gap:20px; font-weight:bold;">
    <a href="/index.html" style="color:#fff; text-decoration:none;">ğŸ  InÃ­cio</a>
    <a href="./blog/agenda.html" style="color:#fff; text-decoration:none;">â„¹ï¸ Agenda</a>
    <a href="./equipe.html" style="color:#fff; text-decoration:none;">ğŸ‘©â€âš•ï¸ Nossa Equipe</a>
  </nav>
    </div>
</body>

<body class="xp-wallpaper">
<div id="menu-container"></div>
<div class="xp-window" style="max-width:1100px;margin:20px auto;">
<div class="xp-titlebar">Dashboard MÃ©dico â€” Triagens</div>
<div class="xp-content">
<div id="alerts"></div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
<div>
  <h3>OcorrÃªncia por sintoma</h3>
  <canvas id="symptomChart"></canvas>
</div>
<div>
  <h3>Triagens recentes</h3>
  <div id="recentList" style="max-height:420px;overflow:auto"></div>
</div>
</div>
</div>


<script>
async function load(){
  const token = localStorage.getItem('adm_token') ? 'Bearer ' + localStorage.getItem('adm_token') : null;
  if(!token){ alert('FaÃ§a login ADM em /admin-login.html'); return; }
  const res = await fetch('/api/triagem', {headers:{Authorization: token}});
  const data = await res.json();
  const recent = data;
  document.getElementById('recentList').innerHTML = recent.map(r=>`<div style="padding:8px;border-bottom:1px solid #ddd"><strong>#${r.id}</strong> ${r.patient_name||'â€”'} â€” ${new Date(r.created_at).toLocaleString()}<pre>${JSON.stringify(r.answers,null,2)}</pre></div>`).join('');
  // simple counts
  const counts = {};
  data.forEach(r=>{
    const txt = JSON.stringify(r.answers).toLowerCase();
    if(txt.includes('febre')) counts['Febre']=(counts['Febre']||0)+1;
    if(txt.includes('falta de ar')) counts['Falta de ar']=(counts['Falta de ar']||0)+1;
    if(txt.includes('dor')) counts['Dor']=(counts['Dor']||0)+1;
  });
  const labels = Object.keys(counts);
  const values = labels.map(l=>counts[l]);
  const ctx = document.getElementById('symptomChart').getContext('2d');
  new Chart(ctx, {type:'bar', data:{labels, datasets:[{label:'OcorrÃªncias', data:values}]}, options:{responsive:true}});
}
load();
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>
