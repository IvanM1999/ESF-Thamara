-- CriaÃ§Ã£o da tabela de interaÃ§Ãµes do Chatbot
CREATE TABLE IF NOT EXISTS chatbot_interactions (
    id SERIAL PRIMARY KEY,
    intent_id VARCHAR(50) UNIQUE NOT NULL,
    keys TEXT[] NOT NULL, -- Array de palavras-chave/frases
    response TEXT NOT NULL, -- Resposta em HTML
    options TEXT[] -- Array de botÃµes (opcional)
);

-- InserÃ§Ã£o dos dados iniciais (Baseado na sua inteligÃªncia atual)
INSERT INTO chatbot_interactions (intent_id, keys, response, options) VALUES
('saudacao', ARRAY['ola', 'oi', 'bom dia', 'boa tarde', 'boa noite', 'gostaria de falar com alguem', 'iniciar atendimento', 'oi tudo bem', 'opa', 'eai', 'preciso de ajuda', 'alo'], 'OlÃ¡! Sou a IA da ESF Thamara. ğŸ¥<br>Estou aqui para agilizar seu atendimento. Posso informar sobre **horÃ¡rios, vacinas, endereÃ§os** ou realizar uma **prÃ©-triagem** dos seus sintomas.<br><br>Se preferir falar com um atendente, digite "telefone".<br>Como posso ajudar?', ARRAY['HorÃ¡rios', 'Telefones', 'Estou com dor', 'EndereÃ§o']),

('horarios', ARRAY['qual o horario de atendimento', 'que horas o posto abre', 'ate que horas funciona', 'horario de funcionamento', 'estÃ¡ aberto agora', 'agenda da unidade', 'que horas fecha', 'tem gente no posto agora', 'expediente', 'dias de funcionamento'], 'ğŸ•’ **DinÃ¢mica de Atendimento:**<br>â€¢ **Seg, Ter e Qui:** ManhÃ£ (intercorrÃªncias/agendamentos), Tarde (consultas/enfermagem).<br>â€¢ **Quarta:** ManhÃ£ (intercorrÃªncias), Tarde (visitas domiciliares).<br>â€¢ **Sexta:** ManhÃ£ (intercorrÃªncias), Tarde (formaÃ§Ã£o equipe).<br>ğŸš« **AlmoÃ§o:** 12h Ã s 13h (fechado).<br>âš ï¸ Fora desses horÃ¡rios, procure o AG Garcia ou Hospitais.', ARRAY['Como agendar consulta?', 'Onde fica o AG Garcia?']),

('endereco', ARRAY['qual o endereÃ§o', 'onde fica o posto', 'localizaÃ§Ã£o da unidade', 'como chegar no posto', 'mapa da unidade', 'rua do posto', 'bairro progresso', 'perto de onde'], 'ğŸ“ **EndereÃ§o:**<br>Rua Santa Maria, 2082 â€“ Bairro Progresso, Blumenau (SC).<br>CEP: 89027-202.', ARRAY['Ver no Mapa', 'HorÃ¡rios']),

('contato', ARRAY['qual o telefone', 'numero para contato', 'como ligar para o posto', 'tem whatsapp', 'numero do zap', 'telefone fixo', 'contato da recepcao', 'falar com humano', 'falar com atendente', 'falar com pessoa', 'atendimento humano'], 'ğŸ“ **Atendimento Humano / Telefones:**<br>Para falar diretamente com nossa equipe, ligue para:<br>**(47) 3381-7064** ou **(47) 3381-6751**.<br>Nosso atendimento telefÃ´nico segue o horÃ¡rio da unidade (07h-12h, 13h-16h).<br>No momento nÃ£o temos WhatsApp oficial.', ARRAY['Voltar ao inÃ­cio', 'HorÃ¡rios']),

('vacinas', ARRAY['horario de vacinacao', 'quero tomar vacina', 'tem vacina da gripe', 'campanha de vacinacao', 'preciso me vacinar', 'vacina covid', 'vacina bcg', 'gotinha', 'atualizar carteirinha'], 'ğŸ’‰ **Sala de Vacinas:**<br>Segunda a Quinta: 09h Ã s 11h30 e 13h Ã s 15h.<br>Sexta: 09h Ã s 11h30 (somente matutino).<br>Lembre-se de trazer a carteirinha de vacinaÃ§Ã£o e o cartÃ£o do SUS!', ARRAY['Quais documentos levar?', 'Tem vacina da gripe?']),

('consultas', ARRAY['como marcar consulta', 'agendar medico', 'preciso de um clinico geral', 'quero marcar uma consulta', 'tem medico hoje', 'consulta de rotina', 'mostrar exames', 'agendamento'], 'ğŸ‘¨â€âš•ï¸ **Consultas:**<br>O agendamento Ã© feito preferencialmente presencialmente na unidade. Para casos agudos, venha para a triagem (Acolhimento).', ARRAY['Estou com dor aguda', 'Ã‰ apenas rotina']),

('odonto', ARRAY['tem dentista', 'estou com dor de dente', 'agendar dentista', 'atendimento odontologico', 'arrancar dente', 'limpeza nos dentes', 'canal', 'dentista sus'], 'ğŸ¦· **Odontologia:**<br>Temos atendimento odontolÃ³gico. Ã‰ necessÃ¡rio passar pela recepÃ§Ã£o para verificar a disponibilidade de agendamento.', ARRAY['Estou com muita dor de dente', 'Quero agendar limpeza']),

('triagem', ARRAY['estou passando mal', 'muita dor', 'emergencia', 'sintomas de dengue', 'febre alta', 'preciso de atendimento urgente', 'tontura forte', 'desmaio', 'sangramento', 'pressao baixa', 'dor de barriga', 'dor no estomago', 'dor abdominal', 'dor de garganta', 'dor de ouvido', 'enjoo', 'vomito', 'diarreia', 'dor na barriga'], 'âš ï¸ **Acolhimento/Triagem:**<br>Para dores agudas (barriga, garganta, ouvido, etc) ou mal-estar geral, venha Ã  unidade para classificaÃ§Ã£o de risco.<br><br>ğŸš¨ **Em caso de:** Dor no peito forte, falta de ar intensa ou desmaio, **LIGUE 192 (SAMU)**.', ARRAY['Ligar 192', 'Ir para o posto']),

('visitas', ARRAY['visita domiciliar', 'atendimento em casa', 'paciente acamado', 'agente de saude visita', 'medico vai em casa', 'minha mae nao anda', 'visita do acs'], 'ğŸ  **Visitas Domiciliares:**<br>Ocorrem geralmente nas quartas-feiras Ã  tarde. SÃ£o destinadas a pacientes acamados ou com dificuldade de locomoÃ§Ã£o. Converse com seu Agente de SaÃºde (ACS) para solicitar.', ARRAY['Como falar com ACS?', 'Voltar']),

('dor_cotovelo_membros', ARRAY['dor no cotovelo', 'dor de cotovelo', 'dor no braÃ§o', 'machuquei o joelho', 'torci o pÃ©', 'dor na perna', 'dor nas juntas', 'cotovelo doendo', 'pulso aberto', 'dor nas costas', 'travei a coluna', 'dor no ombro', 'dor muscular', 'pancada'], 'âš ï¸ **Triagem OrtopÃ©dica (Membros/Coluna):**<br>Para melhor orientaÃ§Ã£o, analise:<br>1. Houve trauma (batida/queda) recente?<br>2. HÃ¡ inchaÃ§o ou deformidade visÃ­vel?<br>3. A dor impede o movimento?<br><br>ğŸ”´ **VÃ¡ ao Pronto Socorro se:** Houver deformidade evidente ou dor insuportÃ¡vel.<br>ğŸŸ¢ **Cuidados em casa:** Se for leve, aplique gelo e repouso.', ARRAY['Onde fica o PS?', 'Vou aplicar gelo', 'Quero ver um mÃ©dico']),

('dor_cabeca', ARRAY['dor de cabeÃ§a', 'enxaqueca', 'cabeÃ§a doendo muito', 'pontada na cabeÃ§a', 'cefaleia', 'visao turva', 'cabeca explodindo'], 'ğŸ§  **Triagem: Dor de CabeÃ§a**<br>Responda mentalmente:<br>â€¢ A dor Ã© a pior da sua vida?<br>â€¢ Tem alteraÃ§Ãµes na visÃ£o ou fala?<br>â€¢ Teve febre junto?<br><br>Se respondeu **SIM** para algo, procure atendimento imediato. Se for uma dor conhecida (enxaqueca comum), tome sua medicaÃ§Ã£o de costume e repouse em local escuro.', ARRAY['Ã‰ uma dor muito forte', 'Ã‰ uma dor comum', 'Preciso de atestado']),

('dor_peito_cardio', ARRAY['dor no peito', 'aperto no coraÃ§Ã£o', 'pontada no peito', 'infarto', 'dor toracica', 'queimaÃ§Ã£o no peito', 'formigamento no braco', 'coracao acelerado'], 'ğŸš¨ **ATENÃ‡ÃƒO - POSSÃVEL EMERGÃŠNCIA** ğŸš¨<br>Dor no peito pode ser grave. Se a dor for forte, irradiar para o braÃ§o esquerdo ou vier acompanhada de falta de ar/suor frio:<br><br>ğŸ“ **LIGUE 192 (SAMU) IMEDIATAMENTE** ou vÃ¡ Ã  emergÃªncia hospitalar mais prÃ³xima (H. Santa Isabel).<br>NÃ£o espere por agendamento no posto.', ARRAY['Ligar 192', 'Onde fica o Hospital?', 'Ã‰ sÃ³ uma pontada leve']),

('febre', ARRAY['estou com febre', 'meu filho tem febre', 'temperatura alta', 'corpo quente', 'calafrios', '39 graus', 'crianca fervendo'], 'ğŸŒ¡ï¸ **Triagem: Febre**<br>â€¢ **Adultos:** Febre acima de 39Â°C ou por mais de 48h requer avaliaÃ§Ã£o.<br>â€¢ **CrianÃ§as:** Se houver manchas na pele, vÃ´mitos ou prostraÃ§Ã£o, venha imediatamente.<br><br>Beba bastante lÃ­quido e monitore a temperatura.', ARRAY['Ã‰ crianÃ§a', 'Ã‰ adulto', 'Tem manchas na pele']),

('identidade', ARRAY['quem Ã© voce', 'voce Ã© um robo', 'quem criou esse bot', 'voce e real'], 'Eu sou o assistente virtual da ESF Thamara! Fui criado para facilitar o acesso Ã s informaÃ§Ãµes da unidade. ğŸ¤–', ARRAY['O que vocÃª sabe fazer?']),

('agradecimento', ARRAY['obrigado', 'valeu', 'muito obrigado', 'ajudou muito', 'tchau', 'ate logo', 'grato', 'beleza'], 'Por nada! Cuide-se bem. ğŸ’™', NULL),

-- NOVAS INTENÃ‡Ã•ES ADICIONADAS --

('renovacao_receita', ARRAY['renovar receita', 'acabou o remedio', 'preciso de losartana', 'pegar remedio de pressao', 'receita venceu', 'receita azul', 'receita controlada', 'renovar medicacao'], 'ğŸ’Š **RenovaÃ§Ã£o de Receitas:**<br>â€¢ **Uso ContÃ­nuo (HipertensÃ£o/Diabetes):** Venha Ã  recepÃ§Ã£o com a receita antiga e documentos.<br>â€¢ **Controlados (PsicotrÃ³picos):** Necessitam de avaliaÃ§Ã£o mÃ©dica. Verifique na recepÃ§Ã£o se hÃ¡ vaga para renovaÃ§Ã£o ou se precisa de consulta.', ARRAY['Ã‰ remÃ©dio de pressÃ£o', 'Ã‰ controlado', 'HorÃ¡rio da farmÃ¡cia']),

('saude_mulher', ARRAY['fazer preventivo', 'papanicolau', 'estou gravida', 'teste de gravidez', 'prÃ© natal', 'consulta ginecologica', 'saude da mulher', 'atraso menstrual', 'pilula anticoncepcional'], 'ğŸŒ¸ **SaÃºde da Mulher:**<br>â€¢ **Preventivo:** Agendado com a enfermeira da sua equipe.<br>â€¢ **Suspeita de Gravidez:** Venha fazer o teste rÃ¡pido (TIG) pela manhÃ£.<br>â€¢ **PrÃ©-Natal:** Se confirmado, iniciamos o acompanhamento imediatamente.', ARRAY['Quero agendar preventivo', 'Acho que estou grÃ¡vida']),

('dengue_zika', ARRAY['dor no corpo todo', 'manchas vermelhas', 'dor atras dos olhos', 'acho que estou com dengue', 'picada de mosquito', 'zika', 'chikungunya', 'dor nas juntas forte'], 'ğŸ¦Ÿ **Suspeita de Dengue:**<br>Se vocÃª tem febre alta, dor atrÃ¡s dos olhos e dores no corpo:<br>1. **Hidrate-se muito** (Ã¡gua, soro).<br>2. **NÃƒO tome remÃ©dios com Ãcido AcetilsalicÃ­lico** (Aspirina, AAS).<br>3. Venha Ã  unidade para avaliaÃ§Ã£o e notificaÃ§Ã£o.', ARRAY['Quais os sintomas?', 'Como prevenir?']),

('saude_mental', ARRAY['estou muito triste', 'ansiedade', 'depressao', 'quero morrer', 'preciso de psicologo', 'crise de ansiedade', 'panico', 'nao aguento mais', 'tristeza profunda'], 'ğŸ§  **SaÃºde Mental:**<br>VocÃª nÃ£o estÃ¡ sozinho(a). ğŸ’™<br>Venha conversar com nossa equipe de acolhimento. Temos grupos de apoio e suporte mÃ©dico.<br><br>ğŸ†˜ **Em crise aguda ou pensamentos urgentes:** Ligue 188 (CVV) ou vÃ¡ ao CAPS/Hospital mais prÃ³ximo.', ARRAY['Ligar 188 (CVV)', 'Ir ao posto conversar']),

('curativos', ARRAY['fazer curativo', 'trocar curativo', 'tirar pontos', 'ferida na perna', 'machucado feio', 'ponto cirurgico'], 'ğŸ©¹ **Sala de Curativos:**<br>Funciona durante o horÃ¡rio da unidade. Traga o encaminhamento (se houver) ou venha para avaliaÃ§Ã£o da enfermeira caso seja uma ferida nova.', ARRAY['HorÃ¡rios', 'Documentos necessÃ¡rios']),

('documentos_cadastro', ARRAY['o que precisa para cadastro', 'fazer cartao sus', 'me mudar para o bairro', 'documentos necessarios', 'comprovante de residencia', 'como me cadastrar'], 'guia **Cadastro na Unidade:**<br>Para se cadastrar na ESF Thamara, traga:<br>â€¢ RG e CPF<br>â€¢ CartÃ£o do SUS (se tiver)<br>â€¢ Comprovante de residÃªncia atualizado em seu nome (ou declaraÃ§Ã£o).<br>Atendemos apenas moradores da Ã¡rea de abrangÃªncia.', ARRAY['Verificar Ã¡rea', 'HorÃ¡rio de cadastro'])

ON CONFLICT (intent_id) DO NOTHING;

-- INSERÃ‡ÃƒO DE NOVOS CENÃRIOS DE TRIAGEM COMPLEXA E ACESSIBILIDADE --
INSERT INTO chatbot_interactions (intent_id, keys, response, options) VALUES

('tabela_decisao', ARRAY['tabela de sintomas', 'onde devo ir', 'quando ir ao hospital', 'quando ir ao posto', 'classificacao de risco', 'estou em duvida', 'guia de atendimento'], 'ğŸ¥ **Guia RÃ¡pido de DecisÃ£o:**<br><table style="width:100%; border-collapse:collapse; font-size:13px; margin-top:5px;"><tr><th style="border:1px solid #ccc; padding:5px; background:#f0f0f0;">Sintoma / SituaÃ§Ã£o</th><th style="border:1px solid #ccc; padding:5px; background:#f0f0f0;">Onde Ir?</th></tr><tr><td style="border:1px solid #ccc; padding:5px;">Risco de Vida / Acidentes Graves</td><td style="border:1px solid #ccc; padding:5px; color:red; font-weight:bold;">SAMU (192) / Hospital</td></tr><tr><td style="border:1px solid #ccc; padding:5px;">Dores Agudas / Febre / Curativos</td><td style="border:1px solid #ccc; padding:5px; color:blue; font-weight:bold;">ESF (Posto)</td></tr><tr><td style="border:1px solid #ccc; padding:5px;">DÃºvidas / Sintomas Leves</td><td style="border:1px solid #ccc; padding:5px; color:green; font-weight:bold;">AlÃ´ SaÃºde (156)</td></tr><tr><td style="border:1px solid #ccc; padding:5px;">Gripe Leve (sem falta de ar)</td><td style="border:1px solid #ccc; padding:5px;">Isolamento (Casa)</td></tr></table>', ARRAY['Entendi', 'EmergÃªncia']),

('alo_saude', ARRAY['alo saude', 'atendimento por telefone', 'consulta online', 'telemedicina', 'duvida simples', 'preciso sair de casa', 'atendimento remoto'], 'ğŸ“ **AlÃ´ SaÃºde Blumenau (156 opÃ§Ã£o 2):**<br>Para orientaÃ§Ãµes mÃ©dicas sem sair de casa, ligue 156.<br>Ideal para: Sintomas leves, dÃºvidas sobre medicamentos e orientaÃ§Ãµes gerais.<br>Evite filas desnecessÃ¡rias e riscos de contÃ¡gio!', ARRAY['Ligar 156', 'Voltar']),

('sindrome_gripal', ARRAY['tosse', 'coriza', 'dor de garganta leve', 'gripe', 'resfriado', 'nariz escorrendo', 'espirrando', 'sintomas de gripe'], 'ğŸ˜· **Sintomas Gripais Leves:**<br>Se vocÃª tem apenas tosse, coriza e febre baixa:<br>1. **Use mÃ¡scara** e evite contato social (Isolamento).<br>2. Hidrate-se e repouse.<br>3. Se piorar (falta de ar), procure o AmbulatÃ³rio Geral (AG) ou Hospital.<br>âš ï¸ **NÃ£o venha ao ESF sem mÃ¡scara!**', ARRAY['Tenho falta de ar', 'Ã‰ sÃ³ gripe leve']),

('emergencia_gestante', ARRAY['estou gravida e com dor', 'sangramento na gravidez', 'perdi liquido', 'bebe nao mexe', 'gestante com dor', 'gravida sangrando', 'dor na barriga gravida'], 'ğŸš¨ **AtenÃ§Ã£o Gestante:**<br>VÃ¡ imediatamente Ã  **Maternidade ou Hospital** se tiver:<br>â€¢ Sangramento vaginal.<br>â€¢ Perda de lÃ­quido.<br>â€¢ Dor abdominal forte.<br>â€¢ AusÃªncia de movimentos do bebÃª.<br>NÃ£o espere pelo ESF, isso Ã© uma emergÃªncia.', ARRAY['Onde fica a maternidade?', 'Ligar SAMU']),

('emergencia_idoso', ARRAY['idoso caiu', 'minha avo caiu', 'fala enrolada', 'boca torta', 'fraqueza de um lado', 'idoso confuso', 'avc', 'derrame', 'idoso nao acorda', 'queda de idoso'], 'ğŸš¨ **EmergÃªncia com Idoso:**<br>Se houver **queda com dor/imobilidade** ou sinais de AVC (boca torta, fala enrolada, perda de forÃ§a):<br>ğŸ“ **LIGUE 192 (SAMU) IMEDIATAMENTE.**<br>NÃ£o tente mover o paciente se houver suspeita de fratura no quadril/fÃªmur.', ARRAY['Ligar 192']),

('emergencia_crianca', ARRAY['meu filho nao respira bem', 'bebe com febre alta', 'crianca prostrada', 'bebe roxo', 'convulsao infantil', 'crianca nao para de chorar', 'bebe engasgado'], 'ğŸš¨ **EmergÃªncia PediÃ¡trica:**<br>Procure o **Hospital** imediatamente se a crianÃ§a apresentar:<br>â€¢ Dificuldade para respirar (peito afundando).<br>â€¢ LÃ¡bios roxos.<br>â€¢ ConvulsÃ£o.<br>â€¢ SonolÃªncia excessiva (nÃ£o acorda).<br>Para febre controlada, procure o ESF ou AlÃ´ SaÃºde.', ARRAY['Hospital Infantil', 'Ligar 192']),

('atendimento_inclusivo', ARRAY['sou autista', 'tenho autismo', 'atendimento prioritario', 'tea', 'sensibilidade sensorial', 'paciente autista', 'mae de autista', 'crise sensorial'], 'ğŸ’™ **Atendimento Inclusivo (TEA):**<br>Pessoas com TEA tÃªm direito a atendimento prioritÃ¡rio e humanizado.<br>Informe na recepÃ§Ã£o sobre suas necessidades (ambiente calmo, menos barulho).<br>Em caso de crise sensorial aguda, nossa equipe estÃ¡ preparada para acolher.', ARRAY['Tenho carteirinha TEA', 'Preciso de prioridade']),

('acessibilidade_leitura', ARRAY['nao sei ler', 'nao sei escrever', 'tenho dificuldade de leitura', 'pode mandar audio', 'ajuda para ler', 'sou analfabeto', 'nao entendo letras'], 'ğŸ—£ï¸ **Acessibilidade:**<br>Se tiver dificuldade para ler ou escrever, vocÃª pode vir Ã  unidade e falar diretamente com a recepÃ§Ã£o, ou pedir para alguÃ©m ligar no **(47) 3381-7064**.<br>Estamos aqui para te ouvir e ajudar!', ARRAY['Ligar para o posto'])

ON CONFLICT (intent_id) DO NOTHING;